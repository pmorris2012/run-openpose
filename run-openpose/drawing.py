import cv2

COLORS_DICT = {
    'body': [
        [255,  0, 85],[255,  0,  0],[255, 85,  0],[255,170,  0],[255,255,  0],
        [170,255,  0],[ 85,255,  0],[  0,255,  0],[255,  0,  0],[  0,255, 85],
        [  0,255,170],[  0,255,255],[  0,170,255],[  0, 85,255],[  0,  0,255],
        [255,  0,170],[170,  0,255],[255,  0,255],[ 85,  0,255],[  0,  0,255],
        [  0,  0,255],[  0,  0,255],[  0,255,255],[  0,255,255],[  0,255,255]
    ],
    'handl': [
        [  0,255,  0],[255,  0,  0],[191, 47, 47],[127, 63, 63],[ 63, 47, 47],
        [255, 76,  0],[191, 57,  0],[127, 38,  0],[ 63, 19,  0],[255,152,  0],
        [191,114,  0],[127, 76,  0],[ 63, 38,  0],[255,255,  0],[191,191,  0],
        [127,127,  0],[ 63, 63,  0],[  0,255,  0],[  0,191,  0],[  0,127,  0],
        [  0, 63,  0]
    ],
    'handr': [
        [255,255,  0],[255,  0,153],[191,  0,114],[127,  0, 76],[ 63,  0, 38],
        [203,  0,255],[152,  0,191],[101,  0,127],[ 50,  0, 63],[ 50,  0,255],
        [ 37,  0,191],[ 25,  0,127],[ 12,  0, 63],[  0,102,255],[  0, 76,191],
        [  0, 51,127],[  0, 25, 63],[  0,255,255],[  0,191,191],[  0,127,127],
        [  0, 63, 63]
    ],
    'face': [[255,255,255]] * 70
}

PAIRS_DICT = {
    'body': [
        [ 1, 8],[ 1, 2],[ 1, 5],[ 2, 3],[ 3, 4],[ 5, 6],[ 6, 7],[ 8, 9],
        [ 9,10],[10,11],[ 8,12],[12,13],[13,14],[ 1, 0],[ 0,15],[15,17],
        [ 0,16],[16,18],[14,19],[19,20],[14,21],[11,22],[22,23],[11,24]
    ],
    'handl': [
        [ 0, 1],[ 1, 2],[ 2, 3],[ 3, 4],[ 0, 5],[ 5, 6],[ 6, 7],[ 7, 8],
        [ 0, 9],[ 9,10],[10,11],[11,12],[ 0,13],[13,14],[14,15],[15,16],
        [ 0,17],[17,18],[18,19],[19,20]
    ],
    'handr': [
        [ 0, 1],[ 1, 2],[ 2, 3],[ 3, 4],[ 0, 5],[ 5, 6],[ 6, 7],[ 7, 8],
        [ 0, 9],[ 9,10],[10,11],[11,12],[ 0,13],[13,14],[14,15],[15,16],
        [ 0,17],[17,18],[18,19],[19,20]
    ],
    'face': [
        [ 0, 1],[ 1, 2],[ 2, 3],[ 3, 4],[ 4, 5],[ 5, 6],[ 6, 7],[ 7, 8],
        [ 8, 9],[ 9,10],[10,11],[11,12],[12,13],[13,14],[14,15],[15,16],
        [17,18],[18,19],[19,20],[20,21],[22,23],[23,24],[24,25],[25,26],
        [27,28],[28,29],[29,30],[31,32],[32,33],[33,34],[34,35],[36,37],
        [37,38],[38,39],[39,40],[40,41],[41,36],[42,43],[43,44],[44,45],
        [45,46],[46,47],[47,42],[48,49],[49,50],[50,51],[51,52],[52,53],
        [53,54],[54,55],[55,56],[56,57],[57,58],[58,59],[59,48],[60,61],
        [61,62],[62,63],[63,64],[64,65],[65,66],[66,67],[67,60]
    ]
}

def is_empty(keypoint):
    return keypoint.sum() == 0

def draw_point(image, x, y, color):
    radius = int(min(image.shape[0], image.shape[1]) * .005)
    cv2.circle(image, (x, y), radius, color, thickness=radius, lineType=8, shift=0)

def draw_line(image, x1, y1, x2, y2, color):
    thickness = max(2, int(min(image.shape[0], image.shape[1]) / 200.0))
    cv2.line(image, (x1, y1), (x2, y2), color, thickness)

def draw_keypoints(image, keypoints, mode="body"):
    if len(keypoints.shape) == 0:
        return image

    for human in keypoints:
        for i, keypoint in enumerate(human):
            if not is_empty(keypoint):
                point_color = COLORS_DICT[mode][i]
                x_int = int(keypoint[0].round())
                y_int = int(keypoint[1].round())
                draw_point(image, x_int, y_int, point_color)

        for pair in PAIRS_DICT[mode]:
            keypoint0 = human[pair[0]]
            keypoint1 = human[pair[1]]
            if not is_empty(keypoint0) and not is_empty(keypoint1):
                line_color = COLORS_DICT[mode][pair[1]]
                x0_int = int(keypoint0[0].round())
                y0_int = int(keypoint0[1].round())
                x1_int = int(keypoint1[0].round())
                y1_int = int(keypoint1[1].round())
                draw_line(image, x0_int, y0_int, x1_int, y1_int, line_color)

    return image

